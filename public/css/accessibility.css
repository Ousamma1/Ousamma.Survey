/**
 * Accessibility Styles - Digital Dubai Survey System
 *
 * This file contains accessibility-focused styles including focus indicators,
 * keyboard navigation support, screen reader utilities, and WCAG compliance features.
 */

/* ========================================
   FOCUS INDICATORS
   ======================================== */

/* Global focus styles */
*:focus {
  outline: none;
}

*:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* Button focus */
button:focus-visible,
.btn:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 3px;
  box-shadow: 0 0 0 5px rgba(47, 96, 165, 0.2);
}

/* Input focus - already handled in components.css but enhanced here */
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 0;
  box-shadow: 0 0 0 5px rgba(47, 96, 165, 0.15);
}

/* Link focus */
a:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
  text-decoration: underline;
}

/* Card focus (for interactive cards) */
.card[tabindex]:focus-visible,
.stat-card[tabindex]:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 4px;
  box-shadow: 0 0 0 5px rgba(47, 96, 165, 0.1);
}

/* ========================================
   KEYBOARD NAVIGATION
   ======================================== */

/* Skip to main content link */
.skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  background: var(--color-primary-500);
  color: white;
  padding: var(--space-5) var(--space-10);
  text-decoration: none;
  font-weight: var(--font-weight-semibold);
  z-index: 9999;
  border-radius: 0 0 var(--radius-md) 0;
  transition: top var(--transition-fast);
}

.skip-link:focus {
  top: 0;
  outline: 3px solid white;
  outline-offset: -5px;
}

/* Keyboard-only focus (hide focus for mouse users) */
.js-focus-visible :focus:not(.focus-visible) {
  outline: none;
}

/* Enhanced focus for navigation items */
.nav-link:focus-visible,
.sidebar-nav-link:focus-visible {
  outline: 3px solid white;
  outline-offset: 2px;
  background: rgba(255, 255, 255, 0.2);
}

/* Tab navigation indicator */
[role="tab"]:focus-visible,
.tab:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 4px;
  z-index: 1;
}

/* Modal focus trap */
.modal[aria-modal="true"] {
  position: relative;
}

.modal:focus {
  outline: none;
}

/* ========================================
   SCREEN READER UTILITIES
   ======================================== */

/* Visually hidden but accessible to screen readers */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Focusable screen reader only content */
.sr-only-focusable:active,
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* Not visible but readable by screen readers */
.visually-hidden {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* ========================================
   ARIA LIVE REGIONS
   ======================================== */

.aria-live {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

/* Status messages */
[role="status"],
[role="alert"] {
  padding: var(--space-5) var(--space-7);
  border-radius: var(--radius-lg);
  margin: var(--space-5) 0;
}

[role="alert"] {
  background: rgba(217, 83, 79, 0.1);
  border: 1px solid var(--color-danger);
  color: var(--color-danger);
}

[role="status"] {
  background: rgba(47, 96, 165, 0.1);
  border: 1px solid var(--color-primary-500);
  color: var(--color-primary-500);
}

/* ========================================
   HIGH CONTRAST MODE
   ======================================== */

@media (prefers-contrast: high) {
  :root {
    --color-primary-500: #1a4d8f;
    --color-text-primary: #000000;
    --color-bg-primary: #ffffff;
  }

  .btn {
    border: 2px solid currentColor;
  }

  .card,
  .stat-card,
  .message-content {
    border: 2px solid var(--color-text-primary);
  }

  a {
    text-decoration: underline;
    font-weight: var(--font-weight-semibold);
  }

  *:focus-visible {
    outline-width: 4px;
    outline-offset: 3px;
  }
}

/* ========================================
   REDUCED MOTION
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .spinner {
    animation: none;
    border-top-color: var(--color-primary-500);
  }

  .message,
  .card,
  .modal,
  .toast {
    animation: none;
  }
}

/* ========================================
   COLOR BLINDNESS SUPPORT
   ======================================== */

/* Add patterns/icons in addition to color for status indicators */
.badge-success::before,
.stat-card-change.positive::before {
  content: '✓ ';
  speak: none;
  speak: never;
  -webkit-user-select: none;
  user-select: none;
}

.badge-danger::before,
.stat-card-change.negative::before {
  content: '✗ ';
  speak: none;
  speak: never;
  -webkit-user-select: none;
  user-select: none;
}

.badge-warning::before {
  content: '⚠ ';
  speak: none;
  speak: never;
  -webkit-user-select: none;
  user-select: none;
}

/* ========================================
   TOUCH TARGET SIZE (MOBILE ACCESSIBILITY)
   ======================================== */

@media (pointer: coarse) {
  /* Ensure minimum 44x44px touch targets */
  button,
  .btn,
  a,
  input[type="checkbox"],
  input[type="radio"] {
    min-width: 44px;
    min-height: 44px;
  }

  .nav-link,
  .sidebar-nav-link {
    padding: var(--space-7);
  }

  .pagination-btn {
    min-width: 44px;
    min-height: 44px;
  }
}

/* ========================================
   TEXT RESIZING
   ======================================== */

/* Ensure text can scale up to 200% */
html {
  font-size: 100%;
}

@media (min-width: 1200px) {
  html {
    font-size: 112.5%; /* 18px base */
  }
}

/* Prevent horizontal scrolling when text is resized */
body {
  overflow-x: hidden;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* ========================================
   FORM ACCESSIBILITY
   ======================================== */

/* Required field indicator */
.required::after,
[aria-required="true"]::after {
  content: ' *';
  color: var(--color-danger);
  font-weight: var(--font-weight-bold);
}

/* Form error announcements */
.form-error {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.form-error::before {
  content: '⚠';
  font-size: var(--font-size-lg);
  flex-shrink: 0;
}

/* Input with error state */
input[aria-invalid="true"],
textarea[aria-invalid="true"],
select[aria-invalid="true"] {
  border-color: var(--color-danger) !important;
  background: rgba(217, 83, 79, 0.05) !important;
}

input[aria-invalid="true"]:focus,
textarea[aria-invalid="true"]:focus,
select[aria-invalid="true"]:focus {
  box-shadow: 0 0 0 5px rgba(217, 83, 79, 0.15) !important;
}

/* ========================================
   TABLE ACCESSIBILITY
   ======================================== */

/* Ensure table headers are properly associated */
table caption {
  padding: var(--space-5);
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-lg);
  text-align: left;
  color: var(--color-text-primary);
}

/* Highlight current row on focus */
table tr:focus-within {
  background: rgba(47, 96, 165, 0.05);
  outline: 2px solid var(--color-primary-500);
  outline-offset: -2px;
}

/* ========================================
   MODAL ACCESSIBILITY
   ======================================== */

/* Prevent body scroll when modal is open */
body.modal-open {
  overflow: hidden;
}

/* Modal backdrop */
.modal-backdrop[aria-hidden="false"] {
  display: flex;
}

.modal-backdrop[aria-hidden="true"] {
  display: none;
}

/* Focus the first focusable element in modal */
.modal[aria-modal="true"] {
  isolation: isolate;
}

/* ========================================
   LOADING & BUSY STATES
   ======================================== */

[aria-busy="true"] {
  position: relative;
  pointer-events: none;
  opacity: 0.6;
}

[aria-busy="true"]::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40px;
  height: 40px;
  border: 3px solid var(--color-border-light);
  border-top-color: var(--color-primary-500);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* ========================================
   EXPANDABLE SECTIONS
   ======================================== */

[aria-expanded="true"] .expand-icon {
  transform: rotate(180deg);
}

[aria-expanded="false"] .expand-icon {
  transform: rotate(0deg);
}

.expand-icon {
  transition: transform var(--transition-base);
}

/* ========================================
   DISABLED STATES
   ======================================== */

[aria-disabled="true"],
[disabled] {
  cursor: not-allowed !important;
  opacity: 0.6 !important;
  pointer-events: none !important;
}

button[aria-disabled="true"],
button[disabled] {
  background: var(--color-neutral-600) !important;
}

/* ========================================
   DARK MODE ACCESSIBILITY
   ======================================== */

@media (prefers-color-scheme: dark) {
  :root {
    --color-text-primary: #f3f4f6;
    --color-text-secondary: #d1d5db;
    --color-bg-primary: #1f2937;
    --color-bg-secondary: #111827;
    --color-border-light: #374151;
  }

  /* Ensure sufficient contrast in dark mode */
  .message-content,
  .card,
  .stat-card {
    background: var(--color-bg-primary);
    color: var(--color-text-primary);
  }

  /* Adjust focus indicators for dark mode */
  *:focus-visible {
    outline-color: #60a5fa;
  }

  /* Ensure links are visible */
  a {
    color: #60a5fa;
  }

  a:hover {
    color: #93c5fd;
  }
}

/* ========================================
   PRINT ACCESSIBILITY
   ======================================== */

@media print {
  /* Show link URLs */
  a[href]::after {
    content: " (" attr(href) ")";
    font-size: smaller;
  }

  /* Don't show URLs for internal links */
  a[href^="#"]::after,
  a[href^="javascript:"]::after {
    content: "";
  }

  /* Ensure focus indicators don't print */
  *:focus-visible {
    outline: none;
  }

  /* Print page breaks */
  .page-break {
    page-break-after: always;
  }

  /* Avoid breaking inside elements */
  .card,
  .stat-card,
  .message {
    page-break-inside: avoid;
  }
}

/* ========================================
   LANGUAGE SUPPORT (RTL)
   ======================================== */

[dir="rtl"] .nav-link::after {
  left: auto;
  right: 0;
}

[dir="rtl"] .message.user {
  flex-direction: row;
}

[dir="rtl"] .message.agent {
  flex-direction: row-reverse;
}

[dir="rtl"] .expand-icon {
  transform: scaleX(-1);
}

/* ========================================
   TOOLTIPS ACCESSIBILITY
   ======================================== */

[data-tooltip] {
  position: relative;
}

[data-tooltip]:hover::after,
[data-tooltip]:focus::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--color-text-primary);
  color: white;
  padding: var(--space-2) var(--space-5);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  white-space: nowrap;
  z-index: var(--z-index-tooltip);
  margin-bottom: var(--space-2);
  pointer-events: none;
}

[data-tooltip]:hover::before,
[data-tooltip]:focus::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--color-text-primary);
  z-index: var(--z-index-tooltip);
  pointer-events: none;
}

/* ========================================
   CUSTOM CHECKBOX/RADIO ACCESSIBILITY
   ======================================== */

/* Enhance native checkbox/radio for better visibility */
input[type="checkbox"],
input[type="radio"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: var(--color-primary-500);
}

input[type="checkbox"]:focus-visible,
input[type="radio"]:focus-visible {
  outline: 3px solid var(--color-primary-500);
  outline-offset: 3px;
}

/* ========================================
   UTILITIES
   ======================================== */

/* Remove animations for users who prefer reduced motion */
.no-animation {
  animation: none !important;
  transition: none !important;
}

/* Force focus visibility */
.force-focus-visible:focus {
  outline: 3px solid var(--color-primary-500) !important;
  outline-offset: 2px !important;
}
